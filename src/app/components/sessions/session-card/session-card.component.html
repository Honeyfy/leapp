<td (click)="switchCredentials()" (contextmenu)="openOptionBar(session);">
  <img src="assets/images/{{getSessionTypeIcon(session.type)}}.png" alt="" title="" />
  &nbsp;
  <span class="{{session.status === eSessionStatus.active ? 'strong' : ''}}">{{session.sessionName}}</span>
  &nbsp;
  <i class="fal fa-thumbtack" *ngIf="workspaceService.getWorkspace().pinned.indexOf(session.sessionId) !== -1"></i>
</td>
<td (click)="switchCredentials()" (contextmenu)="openOptionBar(session);">
  <ng-container *ngIf="session.type !== eSessionType.awsIamUser">{{ session | detail }}</ng-container>
</td>
<td (click)="switchCredentials()" (contextmenu)="openOptionBar(session);">
  <span class="badge badge-rounded badge-{{getSessionProviderClass(session.type)}}">{{getSessionProviderLabel(session.type)}}</span>
</td>
<td (click)="switchCredentials()" (contextmenu)="openOptionBar(session);">
  <ng-container *ngIf="session.type !== eSessionType.azure">
  {{getProfileName(getProfileId(session))}}
  <a (click)="copyProfile(getProfileName(getProfileId(session)))"><i class="fal fa-copy"></i></a>
  </ng-container>
</td>
<td (click)="switchCredentials()" (contextmenu)="openOptionBar(session);">
  <span class="badge badge-{{session.status === eSessionStatus.active ? 'black' : 'gray'}}">{{session.region}}</span>
</td>
<td (click)="switchCredentials()" (contextmenu)="openOptionBar(session);">
  <i class="status-item fas fa-circle {{session.status === eSessionStatus.active ? 'active' : 'offline'}}" *ngIf="session.status !== eSessionStatus.pending"></i>
  <i class="status-item far fa-spinner-third fa-spin" *ngIf="session.status === eSessionStatus.pending"></i>
</td>

<ng-container *ngIf="eOptionIds[session.sessionId]">
  <div class="option-bar">
    <a class="icon-button start-session"><i class="fad fa-play-circle"></i>&nbsp;Start Session</a>

    <div>
      <a class="icon-button" (click)="changeRegionModalOpen(session);" tooltip="Change Region"><i class="fal fa-globe"></i></a>
      <a class="icon-button" *ngIf="session.type !== eSessionType.azure" (click)="changeProfileModalOpen();" tooltip="Change Named Profile"><i class="fal fa-user-circle"></i></a>
      <a class="icon-button" (click)="ssmModalOpen(session);" *ngIf="session.type !== eSessionType.azure" tooltip="Open SSM connection"><i class="fal fa-list"></i></a>
      <a class="icon-button" *ngIf="session.type === eSessionType.awsIamUser && session.status !== eSessionStatus.active" (click)="editSession(session, $event);" tooltip="Edit Session"><i class="fal fa-list"></i></a>

      <ng-container *ngIf="(session.type === eSessionType.awsIamRoleFederated || session.type === eSessionType.awsIamRoleChained || session.type === eSessionType.awsSsoRole)">
        <a class="icon-button" (click)="copyCredentials(session, 1, $event);" tooltip="Copy Account Number"><i class="fal fa-copy"></i></a>
        <a class="icon-button" (click)="copyCredentials(session, 2, $event);" tooltip="Copy Role ARN"><i class="fal fa-copy"></i></a>
      </ng-container>

      <span class="separator"></span>

      <a class="icon-button" (click)="deleteSession(session, $event);" tooltip="Delete Session"><i class="fal fa-trash"></i></a>
    </div>

    <div class="session-name">{{session.sessionName}}</div>
  </div>
</ng-container>

<ng-template #ssmModalTemplate>
  <div class="modal-header">
    <a class="back" aria-label="Close" (click)="modalRef.hide();"><i class="fa fa-arrow-left"></i></a>
    <b>{{session.sessionName}}</b> - {{ session | detail }} | <b>SSM Session</b>
  </div>
  <div class="modal-body">

    <div class="ssm-tray">

      <b class="">Select a Region:</b>
      <ng-select bindLabel="region" bindValue="region" [items]="awsRegions" [(ngModel)]="selectedSsmRegion" placeholder="Select a Region for finding instances" (change)="changeSsmRegion($event, session);"></ng-select>

      <div class="loader" *ngIf="ssmLoading"><i class="fa fa-spinner fa-spin"></i></div>
      <div class="list-of-ssm" *ngIf="!ssmLoading">
        <ng-container *ngIf="!ssmLoading && !firstTimeSsm">
          <b>Select an EC2 Instance:</b><br>
          <input class="form-control" type="text" placeholder="search by..." (keyup)="searchSSMInstance($event)" />
        </ng-container>

        <ul class="ssm-ul" *ngIf="instances.length > 0">
          <li *ngFor="let instance of instances" class="ssm-card">
            <div>
              <span><b>{{instance.Name.length >= 24 ? instance.Name.substr(0, 21) + '...' : instance.Name}}</b> - {{instance.IPAddress}}</span>
              <button class="btn" (click)="startSsmSession(session.sessionId, instance.InstanceId)">
                <i class="fa fa-spinner fa-spin" *ngIf="instance.loading"></i>
                <span *ngIf="!instance.loading">Connect</span>
              </button>
            </div>
          </li>
        </ul>
      </div>

    </div>
  </div>
</ng-template>

<ng-template #defaultRegionModalTemplate>
  <div class="modal-header">
    <a class="back" aria-label="Close" (click)="modalRef.hide();"><i class="fa fa-arrow-left"></i></a>
    <b>{{session.sessionName}}</b> - {{session | detail }} | <b>Edit {{session.type === eSessionType.azure ? 'Location' : 'Region'}}</b>
  </div>
  <div class="modal-body">

    <div class="ssm-tray">

      <b class="">Select a default region for the session:</b>
      <ng-select bindLabel="{{session.type === eSessionType.azure ? 'location' : 'region'}}" bindValue="{{session.type === eSessionType.azure ? 'location' : 'region'}}" [items]="regionOrLocations" [(ngModel)]="selectedDefaultRegion" placeholder="{{placeholder}}"></ng-select>

      <button type="button" (click)="goBack();" class="pull-left disabled">Back</button>
      <button type="button" (click)="changeRegion();" [disabled]="!selectedDefaultRegion" [ngClass]="(!selectedDefaultRegion) ? 'pull-right disabled': 'pull-right'">Save</button>
    </div>
  </div>
</ng-template>

<ng-template #defaultProfileModalTemplate>
  <div class="modal-header">
    <a class="back" aria-label="Close" (click)="modalRef.hide();"><i class="fa fa-arrow-left"></i></a>
    <b>{{session.sessionName}}</b> - {{ session | detail }} | <b>Edit Profile</b>
  </div>
  <div class="modal-body">

    <div class="ssm-tray">

      <b class="">Select a profile for the session:</b>
      <ng-select bindLabel="name"
                 [addTag]="addNewProfile"
                 [items]="profiles"
                 [(ngModel)]="selectedProfile"
                 placeholder="select a profile"></ng-select>

      <button type="button" (click)="goBack();" class="pull-left disabled">Back</button>
      <button type="button" (click)="changeProfile();" [disabled]="!selectedProfile" [ngClass]="(!selectedProfile) ? 'pull-right disabled': 'pull-right'">Save</button>
    </div>
  </div>
</ng-template>
